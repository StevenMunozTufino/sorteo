<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Compra de Boletos</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>

    <h1>Compra de Boletos</h1>
    <label for="tickets">Número de boletos a comprar:</label>
    <input type="number" id="tickets" value="1" min="1" onchange="calculateTotal()">
    <p>Precio por boleto: $1.00</p>
    <p>Total a pagar: $<span id="total">1.00</span></p>
    <button onclick="pay()">Pagar</button>

    <script>
        const ticketPrice = 1.00; // Precio por boleto en dólares

        // Función para calcular el total basado en la cantidad de boletos seleccionada
        function calculateTotal() {
            const tickets = document.getElementById("tickets").value;
            const total = tickets * ticketPrice;
            document.getElementById("total").textContent = total.toFixed(2);
        }

        // Función para generar la transacción y redirigir a la página de Payphone
        function pay() {
            const tickets = document.getElementById("tickets").value;
            const total = tickets * ticketPrice * 100; // Convertir a centavos
            const clientTransactionId = "tx-" + Date.now();

            const parametros = {
                amount: total,
                amountWithoutTax: total, // Suponiendo que no hay impuestos
                clientTransactionId: clientTransactionId,
                responseUrl: "https://script.google.com/macros/s/AKfycbzo7dZwirWWtMMMy51cEPwGa8l7ayuNrUzthGIzkskiDbyu8lTxTNnZVAkQdB-AKaHD6Q/exec", // URL de respuesta tras el pago
                cancellationUrl: "https://tu-dominio.com/CancelacionPago", // URL en caso de cancelación
                currency: "USD",
                reference: `${tickets}`
            };

            $.ajax({
                url: 'https://pay.payphonetodoesposible.com/api/button/Prepare',
                type: 'POST',
                data: JSON.stringify(parametros),
                contentType: 'application/json',
                beforeSend: function(xhr) {
                    xhr.setRequestHeader('Authorization', "Bearer 1XlSI-OtdXGNOt_ZY5ASyViTDMNVIpYulKdkgcrdI8vUklk4g6iXhlnufeLNL5ZN9ourPSY2brdyV2kZ3123STlqa9zPvORUPMkpghO8R_HK-i6xqN52JbM3ywstgv6uFK9GncS0vhX_kolgMWa5GjrKCZ1wCYEk8npChhH8WfXVRaMQbKBWmgllxuHuzq-P7fOi5JwoQrsVU2KITJZYOm1L3eB4yim_zL3_FVOGOzoEsPEAxq8YTRHUodv-xu2Dr4CskWFPtgaUOs22HZN17m9-LdI40zy6dDYqL9xv0MmBsX3NrTTJqfcg6nBfKvAaC8eQCQ");
                },
                success: function(respuesta) {
                    // Redirigir al usuario a la URL de pago con tarjeta
                    window.location.href = respuesta.payWithCard;
                },
                error: function(error) {
                    alert("Error en la transacción: " + error.message);
                }
            });
        }
    </script>

</body>
</html>
